<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GasGuard - Smart IoT Gas Detection System</title>
    <script src="http://localhost:3001/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
    <style>
    :root {
        --gg-bg: #050f24;
        --gg-surface: #0b1731;
        --gg-surface-soft: #101c3b;
        --gg-border-soft: #1f2b4d;
        --gg-text-main: #f5f7ff;
        --gg-text-sub: #a6b0d8;
        --gg-accent: #4ade80;
        --gg-accent-soft: rgba(74,222,128,0.12);
        --gg-danger: #fb7185;
        --gg-warning: #fbbf24;
        --gg-info: #38bdf8;
        --gg-card-radius: 16px;
        --gg-gap: 18px;
        --gg-shadow: 0 18px 40px rgba(0,0,0,0.45);
        --gg-font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 24px 0 40px;
        background: radial-gradient(circle at top, #0e2346 0, #050b19 60%, #020617 100%);
        font-family: var(--gg-font);
        color: var(--gg-text-main);
    }

    /* main shell centred on screen */
    .gg-shell {
        max-width: 1320px;
        margin: 0 auto;
        padding: 0 24px;
    }

    /* --- HEADER ----------------------------------------------------- */

    .gg-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
    }

    .gg-title-block h1 {
        margin: 0;
        font-size: 24px;
        letter-spacing: 0.04em;
        font-weight: 700;
    }
    .gg-title-block h1 span {
        color: var(--gg-accent);
    }
    .gg-title-block p {
        margin: 4px 0 0;
        font-size: 12px;
        color: var(--gg-text-sub);
        max-width: 520px;
    }

    .gg-header-actions {
        display: flex;
        gap: 10px;
    }
    .gg-chip {
        font-size: 11px;
        padding: 6px 11px;
        border-radius: 999px;
        border: 1px solid var(--gg-border-soft);
        background: rgba(15,23,42,0.8);
        color: var(--gg-text-sub);
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .gg-chip-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--gg-accent);
        box-shadow: 0 0 0 3px var(--gg-accent-soft);
    }
    .gg-chip.badge-link {
        cursor: pointer;
        text-decoration: none;
        border-color: var(--gg-accent);
        color: var(--gg-accent);
    }
    .gg-chip.badge-link:hover {
        background: rgba(34,197,94,0.08);
    }

    /* --- TOP STATUS STRIP ------------------------------------------- */

    .gg-status-strip {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 10px;
        margin-bottom: 18px;
        font-size: 11px;
    }
    .gg-status-pill {
        background: rgba(15,23,42,0.9);
        border-radius: 999px;
        padding: 6px 12px;
        border: 1px solid rgba(148,163,184,0.25);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--gg-text-sub);
    }
    .gg-status-pill strong {
        font-size: 11px;
        color: var(--gg-text-main);
    }
    .gg-pill-value {
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
    }
    .gg-pill-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--gg-accent);
    }
    .gg-pill-dot.offline {
        background: var(--gg-danger);
    }

    /* --- MAIN GRID: LEFT (sensors) + RIGHT (ML) --------------------- */

.gg-main-grid {
  display: grid;
  grid-template-columns: 2fr 1.3fr;
  gap: 20px;
  align-items: stretch;
}

    .gg-panel {
        background: linear-gradient(135deg, #0b1731 0, #050b19 100%);
        border-radius: var(--gg-card-radius);
        padding: 16px 18px 18px;
        box-shadow: var(--gg-shadow);
        border: 1px solid rgba(148,163,184,0.25);
    }

    .gg-panel-title-row {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    .gg-panel-title-row h2 {
        margin: 0;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: #e5e7ff;
    }
    .gg-panel-title-row span.gg-panel-caption {
        font-size: 11px;
        color: var(--gg-text-sub);
    }

    /* sensor cards row */
    .gg-sensor-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: var(--gg-gap);
        margin-bottom: var(--gg-gap);
    }

    .gg-sensor-card {
        position: relative;
        padding: 12px 14px;
        border-radius: 12px;
        background: radial-gradient(circle at top left, rgba(148,163,184,0.22), #020617);
        border: 1px solid rgba(148,163,184,0.35);
        overflow: hidden;
    }
    .gg-sensor-card::before {
        content: "";
        position: absolute;
        inset: 0;
        border-left: 4px solid var(--gg-accent);
        opacity: 0.85;
    }
    .gg-sensor-inner {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    .gg-sensor-label {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--gg-text-sub);
    }
    .gg-sensor-value {
        font-size: 26px;
        font-weight: 700;
        display: flex;
        align-items: baseline;
        gap: 4px;
    }
    .gg-sensor-value span.unit {
        font-size: 11px;
        color: var(--gg-text-sub);
        font-weight: 500;
    }
    .gg-sensor-status {
        margin-top: 4px;
        font-size: 11px;
        color: var(--gg-text-sub);
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .gg-sensor-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 3px rgba(34,197,94,0.2);
    }

    /* give each sensor card its accent colour */
    .gg-sensor-card.methane::before  { border-left-color: #38bdf8; }
    .gg-sensor-card.lpg::before      { border-left-color: #fb923c; }
    .gg-sensor-card.co::before       { border-left-color: #f97373; }
    .gg-sensor-card.h2s::before      { border-left-color: #a855f7; }

  .gg-chart-box {
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: 18px 20px;
  border-radius: 18px;
  background: linear-gradient(135deg, #0b1731, #020617);
  border: 1px solid rgba(148,163,184,0.25);
  box-shadow: 0 18px 40px rgba(0,0,0,0.45);
}


/* Header */
.gg-chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.gg-chart-header span:first-child {
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: #e5e7ff;
}

.chart-caption {
  font-size: 11px;
  color: var(--gg-text-sub);
}

/* Chart canvas */
.gg-chart-box canvas {
  flex: 1;
  width: 100% !important;
  display: block;
}
.gg-right {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

    .gg-legend-dots {
        display: flex;
        gap: 10px;
        align-items: center;
        font-size: 10px;
    }
    .gg-legend-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #a5b4fc;
    }

    /* right column (ML + quick stats) */
    .gg-right-stack {
        display: flex;
        flex-direction: column;
        gap: var(--gg-gap);
    }

    .gg-ml-card {
        background: linear-gradient(135deg, #052e16 0, #020617 55%);
        border-radius: var(--gg-card-radius);
        padding: 16px 18px 18px;
        border: 1px solid rgba(34,197,94,0.65);
        box-shadow: 0 18px 42px rgba(22,163,74,0.5);
    }
    .gg-ml-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .gg-ml-header h2 {
        margin: 0;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
    }
    .gg-ml-tag {
        font-size: 11px;
        padding: 4px 9px;
        border-radius: 999px;
        border: 1px solid rgba(74,222,128,0.6);
        background: rgba(22,163,74,0.25);
        color: #bbf7d0;
    }
    .gg-ml-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px 14px;
        font-size: 11px;
    }
    .gg-ml-label {
        color: #bbf7d0;
        text-transform: uppercase;
        letter-spacing: 0.16em;
    }
    .gg-ml-value {
        font-size: 16px;
        font-weight: 700;
        margin-top: 2px;
    }
    .gg-ml-risk-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 8px;
        border-radius: 999px;
        background: rgba(248,250,252,0.12);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
    }

    .gg-quick-stats {
        background: var(--gg-surface-soft);
        border-radius: var(--gg-card-radius);
        padding: 12px 14px 14px;
        border: 1px solid var(--gg-border-soft);
        font-size: 11px;
    }
    .gg-quick-stats h3 {
        margin: 0 0 8px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--gg-text-sub);
    }
    .gg-quick-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px 12px;
    }
    .gg-quick-item span {
        display: block;
    }
    .gg-quick-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--gg-text-sub);
    }
    .gg-quick-value {
        font-size: 12px;
        font-weight: 600;
        margin-top: 1px;
    }

    /* --- CONTROLS ROW ----------------------------------------------- */

    .gg-controls-row {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: var(--gg-gap);
        margin-bottom: var(--gg-gap);
    }

    .gg-controls-card {
        background: var(--gg-surface);
        border-radius: var(--gg-card-radius);
        padding: 14px 16px 16px;
        border: 1px solid var(--gg-border-soft);
        box-shadow: var(--gg-shadow);
    }
    .gg-controls-card h3 {
        margin: 0 0 10px;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
    }
    .gg-btn-row {
        display: flex;
  flex-wrap: wrap;
  gap: 10px;
    }
    .gg-btn {
  flex: 1 1 45%;
  min-width: 140px;
  padding: 10px 18px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 500;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;

  cursor: pointer;
  color: #e5e7eb;

  background: linear-gradient(135deg, #0f172a, #020617);
  border: 1px solid rgba(148,163,184,0.25);

  box-shadow: inset 0 0 0 rgba(0,0,0,0);
  transition: 
    background 0.2s ease,
    box-shadow 0.2s ease,
    transform 0.1s ease;
    }
.gg-btn:hover {
  background: linear-gradient(135deg, #111827, #020617);
}
    .gg-btn:active {
  transform: scale(0.96);
    }
    .gg-btn.danger {
     border-color: rgba(239,68,68,0.35);
  color: #fecaca;
    }
    .gg-btn.primary {
        background: linear-gradient(135deg,#22c55e,#15803d);
        color: white;
    }
    .gg-btn.secondary {
        background: linear-gradient(135deg,#3b82f6,#1d4ed8);
        color: white;
    }
    .gg-btn.neutral {
     border-color: rgba(148,163,184,0.35);
  color: #e5e7eb;
    }

    /* --- BLOCKCHAIN MINI-PANEL -------------------------------------- */

    .gg-bottom-row {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 2fr);
        gap: var(--gg-gap);
        margin-top: var(--gg-gap);
    }

    .gg-chain-mini {
        background: var(--gg-surface-soft);
        border-radius: var(--gg-card-radius);
        padding: 14px 16px 16px;
        border: 1px solid var(--gg-border-soft);
    }
    .gg-chain-mini h3 {
        margin: 0 0 6px;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
    }
    .gg-chain-mini p {
        margin: 2px 0;
        font-size: 11px;
        color: var(--gg-text-sub);
    }
    .gg-chain-mini p span {
        color: var(--gg-text-main);
        font-weight: 500;
    }

    .gg-log-card {
        background: var(--gg-surface-soft);
        border-radius: var(--gg-card-radius);
        padding: 12px 14px 14px;
        border: 1px solid var(--gg-border-soft);
        font-size: 11px;
    }
    .gg-log-card h3 {
        margin: 0 0 6px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
    }
    .gg-log-meta {
        margin-bottom: 6px;
        color: var(--gg-text-sub);
    }
    #blockchainLog {
        margin: 0;
        padding: 10px 12px;
        border-radius: 10px;
        background: #020617;
        border: 1px solid rgba(148,163,184,0.35);
        max-height: 150px;
        overflow-y: auto;
        font-family: "JetBrains Mono","Consolas",monospace;
        font-size: 11px;
        white-space: pre-wrap;
    }

    /* --- RESPONSIVE -------------------------------------------------- */

    @media (max-width: 1080px) {
        .gg-main-grid {
            grid-template-columns: minmax(0, 1fr);
        }
        .gg-controls-row {
            grid-template-columns: minmax(0,1fr);
        }
        .gg-bottom-row {
            grid-template-columns: minmax(0,1fr);
        }
    }

    @media (max-width: 720px) {
        body {
            padding-top: 16px;
        }
        .gg-shell {
            padding: 0 14px;
        }
        .gg-status-strip {
            grid-template-columns: repeat(2,minmax(0,1fr));
        }
        .gg-sensor-grid {
            grid-template-columns: minmax(0,1fr);
        }
    }
    .gg-system-mode {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  border-radius: 999px;
  background: rgba(56,189,248,0.15);
  border: 1px solid rgba(56,189,248,0.5);
  font-size: 11px;
  margin-bottom: 14px;
}

.mode-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #38bdf8;
  box-shadow: 0 0 0 3px rgba(56,189,248,0.25);
}
.zone-a { border-color: #38bdf8; color: #bae6fd; }
.zone-b { border-color: #fb923c; color: #fed7aa; }
.zone-c { border-color: #f97373; color: #fecaca; }
.zone-d { border-color: #a855f7; color: #e9d5ff; }

.zone-pill {
  margin-left: 8px;
  padding: 2px 8px;
  font-size: 10px;
  border-radius: 999px;
  background: rgba(74,222,128,0.15);
  border: 1px solid rgba(74,222,128,0.6);
  color: #bbf7d0;
}
.chart-caption {
  font-size: 10px;
  color: var(--gg-text-sub);
}

.gg-ml-note {
  font-size: 10px;
  color: #bbf7d0;
  opacity: 0.85;
  margin-bottom: 6px;
}
.emergency-status {
  margin-top: 10px;
  font-size: 11px;
  color: var(--gg-text-sub);
  line-height: 1.6;
}
.gg-btn.emergency {
 border-color: rgba(239,68,68,0.35);
  color: #fecaca;
}

.gg-btn.emergency:hover {
box-shadow: 0 0 16px rgba(239,68,68,0.35);
}
.gg-btn.success {
  border-color: rgba(34,197,94,0.35);
  color: #bbf7d0;
}

.gg-btn.success:hover {
  box-shadow: 0 0 16px rgba(34,197,94,0.35);
}
.gg-btn.warning {
 border-color: rgba(245,158,11,0.35);
  color: #fde68a;
}

.gg-btn.warning:hover {
  box-shadow: 0 0 16px rgba(245,158,11,0.35);
}
.gg-btn.neutral {
  border-color: rgba(148,163,184,0.35);
  color: #e5e7eb;
}

.gg-btn.neutral:hover {
  box-shadow: 0 0 16px rgba(148,163,184,0.35);
}
.gg-btn.system {
  border-color: rgba(148,163,184,0.35);
  color: #e5e7eb;
}

.gg-btn.system:hover {
  box-shadow: 0 0 16px rgba(148,163,184,0.35);

}

</style>


    </style>
</head> 
    <div class="gg-shell">

    <!-- ====================================================== -->
    <!-- HEADER -->
    <!-- ====================================================== -->
    <div class="gg-header">
        <div class="gg-title-block">
            <h1>GasGuard ‚Äì <span>Smart IoT Gas Detection System</span></h1>
            <p>Real-time gas monitoring with blockchain-backed logging and LSTM-based leak prediction.</p>
        </div>

      <div class="gg-header-actions">
    <a href="main.html" class="gg-chip active">Live Dashboard</a>
    <a href="iot-health.html" class="gg-chip">IoT Health</a>
    <a href="blockchain-history.html" class="gg-chip">Blockchain</a>
    <a href="system-connections.html" class="gg-chip">Connections</a>
</div>


    </div>

    <!-- Overview text -->
    <p class="gg-overview">
        Left side shows live readings and trends. Right side shows ML predictions 
        and blockchain updates.
    </p>
<!-- SYSTEM MODE BANNER -->
<div class="gg-system-mode">
  <span class="mode-dot"></span>
  <strong>System Mode:</strong> Live Simulation (ESP32 Interface Ready)
</div><br>


    <!-- ====================================================== -->
    <!-- STATUS STRIP -->
    <!-- ====================================================== -->
    <div class="gg-status-strip">
        <div class="gg-status-pill">
            <strong>System</strong>
            <div class="gg-pill-value">
                <span class="gg-pill-dot"></span> Online
            </div>
        </div>

        <div class="gg-status-pill">
            <strong>Active Sensors</strong>
            <div class="gg-pill-value"><span id="activeSensors">24</span></div>
        </div>

        <div class="gg-status-pill">
            <strong>Network</strong>
            <div class="gg-pill-value">Connected</div>
        </div>

        <div class="gg-status-pill">
            <strong>Blockchain</strong>
            <div class="gg-pill-value">
                <span class="gg-pill-dot" id="blockchainDot"></span>
                <span id="blockchainStatus">Synced</span>
            </div>
        </div>
    </div>


    <!-- ====================================================== -->
    <!-- EMERGENCY ALERT PANEL -->
    <!-- ====================================================== -->
    <div id="alertPanel" class="alert-panel" style="display:none;">
        <h3>üö® Emergency Alert</h3>
        <p id="alertMessage">High gas concentration detected!</p>
        <button class="gg-btn danger" onclick="acknowledgeAlert()">Acknowledge</button>
    </div>


    <!-- ====================================================== -->
    <!-- MAIN LIVE DASHBOARD GRID (LEFT = Sensors, RIGHT = ML) -->
    <!-- ====================================================== -->
    <div class="gg-main-grid">

        <!-- ====================== LEFT PANNEL ======================= -->
        <div class="gg-panel">

            <div class="gg-panel-title-row">
                <h2>Sensor Readings</h2>
                <span class="gg-panel-caption">Live Data</span>
            </div>

            <!-- SENSOR CARDS -->
            <div class="gg-sensor-grid">

                <div class="gg-sensor-card methane">
                    <div class="gg-sensor-inner">
                        <div class="gg-sensor-label">
                          Methane (MQ-4)
                          <span class="zone-pill zone-a">Zone A</span>
                          </div>
                        <div class="gg-sensor-value">
                            <span id="methane-value">--</span><span class="unit">ppm</span>
                        </div>
                        <div class="gg-sensor-status"><div class="gg-sensor-dot"></div> Active</div>
                    </div>
                </div>

                <div class="gg-sensor-card lpg">
                    <div class="gg-sensor-inner">
                       <div class="gg-sensor-label">
                       LPG (MQ-2)
                       <span class="zone-pill zone-b">Zone B</span>

                        </div>
                        <div class="gg-sensor-value">
                            <span id="lpg-value">--</span><span class="unit">ppm</span>
                        </div>
                        <div class="gg-sensor-status"><div class="gg-sensor-dot"></div> Active</div>
                    </div>
                </div>

                <div class="gg-sensor-card co">
                    <div class="gg-sensor-inner">
                        <div class="gg-sensor-label">
                         Carbon Monoxide (MQ-7)
                        <span class="zone-pill zone-c">Zone C</span>
                         </div>

                        <div class="gg-sensor-value">
                            <span id="co-value">--</span><span class="unit">ppm</span>
                        </div>
                        <div class="gg-sensor-status"><div class="gg-sensor-dot"></div> Active</div>
                    </div>
                </div>

                <div class="gg-sensor-card h2s">
                    <div class="gg-sensor-inner">
                        <div class="gg-sensor-label">
                        Hydrogen Sulfide (MQ-136)
                        <span class="zone-pill zone-d">Zone D</span>
                         </div>

                        <div class="gg-sensor-value">
                            <span id="h2s-value">--</span><span class="unit">ppm</span>
                        </div>
                        <div class="gg-sensor-status"><div class="gg-sensor-dot"></div> Active</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ====================== RIGHT PANEL ======================= -->
        <div class="gg-right-stack">

            <!-- ML Prediction Engine -->
            <div class="gg-ml-card">
                <div class="gg-ml-header">
                    <h2>ML Prediction Engine</h2>
                    <div class="gg-ml-note">
                         Predictive outputs via backend ML interface (simulation mode)
                    </div>
                    <span class="gg-ml-tag">LSTM Model</span>
                </div>

                <div class="gg-ml-grid">
                    <div>
                        <span class="gg-ml-label">Leak Probability</span>
                        <span class="gg-ml-value" id="ml-leak-prob">--</span>
                    </div>

                    <div>
                        <span class="gg-ml-label">Risk Level</span>
                        <span class="gg-ml-value" id="ml-risk-level">--</span>
                    </div>

                    <div>
                        <span class="gg-ml-label">Confidence</span>
                        <span class="gg-ml-value" id="ml-confidence">--</span>
                    </div>

                    <div>
                        <span class="gg-ml-label">Time to Threshold</span>
                        <span class="gg-ml-value" id="ml-time-to-threshold">--</span>
                    </div>
                </div>
            </div>
 

            <!-- QUICK SUMMARY -->
            <div class="gg-quick-stats">
                <h3>System Summary</h3>
                <div class="gg-quick-grid">
                    <div class="gg-quick-item">
                        <span class="gg-quick-label">Last Alert</span>
                        <span class="gg-quick-value" id="summaryLastAlert">--</span>
                    </div>

                    <div class="gg-quick-item">
                        <span class="gg-quick-label">Blockchain Block</span>
                        <span class="gg-quick-value" id="summaryBlock">--</span>
                    </div>

                    <div class="gg-quick-item">
                        <span class="gg-quick-label">Overall Status</span>
                        <span class="gg-quick-value" id="summaryStatus">Normal</span>
                    </div>

                    <div class="gg-quick-item">
                        <span class="gg-quick-label">Today‚Äôs Readings</span>
                        <span class="gg-quick-value" id="summaryReadings">--</span>
                    </div>
                </div>
            </div>

        </div> <!-- END RIGHT PANEL -->

    </div> <!-- END MAIN GRID -->

        <br>
                       <!-- CHART -->
            <div class="gg-chart-box">
               <div class="gg-chart-header">
  <span>Live Gas Trend</span>
  <span class="chart-caption">Last 5 minutes ‚Ä¢ 5s sampling</span>
</div>

                <canvas id="gasChart"></canvas>
            </div> <br>
    <!-- ====================================================== -->
    <!-- CONTROLS ROW -->
    <!-- ====================================================== -->
    <div class="gg-controls-row">

        <div class="gg-controls-card">
            <h3>Emergency Controls</h3>
            <div class="gg-btn-row">
                <button class="gg-btn emergency" onclick="triggerEmergencyProtocol()">üö® Emergency Stop</button>
                <button class="gg-btn success" onclick="activateVentilation()">üí® Ventilation</button>
                <button class="gg-btn warning" onclick="testAlertSystem()">‚ö†Ô∏è Test Alert</button>
            </div>
                         <div class="emergency-status">
  <strong>Status:</strong> Idle<br>
  <span>Last Action:</span> None<br>
  <span>Zone:</span> ‚Äî
</div>
        </div>
       
        <div class="gg-controls-card">
            <h3>System Operations</h3>
            <div class="gg-btn-row">
                <button class="gg-btn neutral" onclick="calibrateSensors()">üîß Calibrate</button>
                <button class="gg-btn system" onclick="generateReport()">üìä Report</button>
                <button class="gg-btn system" onclick="exportData()">üíæ Export</button>
            </div>
        </div>

        <div class="gg-controls-card">
            <h3>Simulation Controls</h3>
            <div class="gg-btn-row">
                <button class="gg-btn warning" onclick="simulateGasLeak()">üî¥ Sim Leak</button>
                <button class="gg-btn success" onclick="simulateNormalOperation()">üü¢ Normal</button>
                <button class="gg-btn system" onclick="resetSystem()">üîÑ Reset</button>
            </div>
        </div>

    </div>


    <!-- ====================================================== -->
    <!-- BLOCKCHAIN MINI PANEL + LOG -->
    <!-- ====================================================== -->
    <div class="gg-bottom-row">

        <div class="gg-chain-mini">
            <h3>Blockchain Sync</h3>
            <p><b>Status:</b> <span id="bc-status">--</span></p>
            <p><b>Value:</b> <span id="latestReadingValue">--</span></p>
            <p><b>Status:</b> <span id="latestReadingStatus">--</span></p>
            <p><b>Time:</b> <span id="latestReadingTime">--</span></p>
            <hr>
            <p><b>Block:</b> <span id="bc-block">--</span></p>
            <p><b>Tx Hash:</b> <span id="bc-tx">--</span></p>
        </div>

        <div class="gg-log-card">
            <h3>Blockchain Log</h3>
            <div class="gg-log-meta">Latest immutable transactions</div>
            <pre id="blockchainLog">Loading...</pre>
        </div>

    </div>


    <!-- FOOTER -->
    <div class="footer"> <center>
        <p>üî¨ Research Prototype ‚Äì Blockchain-Enabled Smart IoT Gas Detection</p>
        <p>Developed for Industrial Safety Applications</p>
        </center>
    </div>

</div> <!-- END gg-shell -->
</body>

    <script>
        // Global variables
        let gasChart;
        let sensorData = {
            methane: [],
            lpg: [],
            co: [],
            h2s: [],
            timestamps: []
        };
        let simulationMode = 'normal';
        let blockNumber = 247;
        let emergencyActive = false;
        const API_BASE = "http://127.0.0.1:3001";


        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            //startSimulation();
            initializeBlockchain();
        });

        // Initialize Chart.js
        function initializeChart() {
            const ctx = document.getElementById('gasChart').getContext('2d');
            gasChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Methane (CH4)',
                            data: [],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.4
                        },
                        {
                            label: 'LPG',
                            data: [],
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.4
                        },
                        {
                            label: 'CO',
                            data: [],
                            borderColor: 'rgb(255, 205, 86)',
                            backgroundColor: 'rgba(255, 205, 86, 0.2)',
                            tension: 0.4
                        },
                        {
                            label: 'H2S',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.3)'
                            }
                        }
                    },
                    animation: {
                        duration: 300
                    }
                }
            });
        }

        // Start sensor simulation
        function startSimulation() {
            setInterval(updateSensorData, 2000); // Update every 2 seconds
        }

        // Update sensor data with realistic simulation
       /* function updateSensorData() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            let methane, lpg, co, h2s;
            
            if (simulationMode === 'leak') {
                // Simulate gas leak with increasing values
                methane = 400 + Math.random() * 200 + Math.sin(Date.now() / 1000) * 50;
                lpg = 300 + Math.random() * 150 + Math.sin(Date.now() / 1000) * 30;
                co = 150 + Math.random() * 100 + Math.sin(Date.now() / 1000) * 20;
                h2s = 80 + Math.random() * 40 + Math.sin(Date.now() / 1000) * 10;
                
                if (!emergencyActive && methane > 500) {
                    triggerAlert("Critical methane levels detected in Zone A");
                }
            } else {
                // Normal operation with small variations
                methane = 245 + Math.random() * 20 - 10;
                lpg = 156 + Math.random() * 15 - 7;
                co = 89 + Math.random() * 10 - 5;
                h2s = 23 + Math.random() * 8 - 4;
            }

            // Update sensor displays
            updateSensorCard('methane', Math.round(methane));
            updateSensorCard('lpg', Math.round(lpg));
            updateSensorCard('co', Math.round(co));
            updateSensorCard('h2s', Math.round(h2s));

            // Update chart data
            sensorData.timestamps.push(timeStr);
            sensorData.methane.push(methane);
            sensorData.lpg.push(lpg);
            sensorData.co.push(co);
            sensorData.h2s.push(h2s);

            // Keep only last 20 data points
            if (sensorData.timestamps.length > 20) {
                sensorData.timestamps.shift();
                sensorData.methane.shift();
                sensorData.lpg.shift();
                sensorData.co.shift();
                sensorData.h2s.shift();
            }

            // Update chart
            gasChart.data.labels = sensorData.timestamps;
            gasChart.data.datasets[0].data = sensorData.methane;
            gasChart.data.datasets[1].data = sensorData.lpg;
            gasChart.data.datasets[2].data = sensorData.co;
            gasChart.data.datasets[3].data = sensorData.h2s;
            gasChart.update('none');

            // Log to blockchain every 10 readings
            if (sensorData.timestamps.length % 5 === 0) {
                logToBlockchain('sensor_reading', {
                    methane: Math.round(methane),
                    lpg: Math.round(lpg),
                    co: Math.round(co),
                    h2s: Math.round(h2s),
                    timestamp: now.toISOString()
                });
            }
        }*/

        // Update sensor card display
        function updateSensorCard(sensor, value) {
            document.getElementById(sensor + '-value').textContent = value;
            
            const card = document.getElementById(sensor + '-card');
            const indicator = card.querySelector('.status-indicator');
            
            // Update status based on thresholds
            let threshold;
            switch(sensor) {
                case 'methane': threshold = 400; break;
                case 'lpg': threshold = 300; break;
                case 'co': threshold = 150; break;
                case 'h2s': threshold = 50; break;
            }
            
            if (value > threshold) {
                indicator.className = 'status-indicator status-critical';
                card.style.borderColor = '#F44336';
            } else if (value > threshold * 0.8) {
                indicator.className = 'status-indicator status-warning';
                card.style.borderColor = '#FF9800';
            } else {
                indicator.className = 'status-indicator status-online';
                card.style.borderColor = 'rgba(255,255,255,0.2)';
            }
        }

        // Initialize blockchain simulation
        function initializeBlockchain() {
            document.getElementById('latestBlock').textContent = '#' + blockNumber;
            document.getElementById('gasLimit').textContent = '8,000,000';
        }

        // --- BACKEND POLLING FUNCTION ---
function startBackendPolling() {
    fetchBackendStatus();                  
    setInterval(fetchBackendStatus, 5000); 

    document.getElementById("blockchainStatus").textContent = "Online";
    document.getElementById("blockchainStatus").style.color = "lightgreen";

}

// --- FETCH DATA FROM YOUR NODE.JS BACKEND ---
async function fetchBackendStatus() {
    try {
        const latest = await fetch("http://127.0.0.1:3000/latest").then(r => r.json());

        const value = Number(latest.value);
const status = latest.status;
const timestamp = latest.timestamp;

if (!value && value !== 0) {
    throw new Error("Invalid blockchain data");
}

// Update your dashboard UI
updateSensorCard("methane", value);

// CALL ML PREDICTION FUNCTION HERE
if (!isNaN(value)) {
    updateMlPredictionFromValue(value, status);
}

        const timeStr = new Date().toLocaleTimeString();
        sensorData.timestamps.push(timeStr);
        sensorData.methane.push(value);

        if (sensorData.timestamps.length > 20) {
            sensorData.timestamps.shift();
            sensorData.methane.shift();
        }

        gasChart.data.labels = sensorData.timestamps;
        gasChart.data.datasets[0].data = sensorData.methane;
        gasChart.update("none");

        if (status === "Alert") {
            triggerAlert(`Blockchain ALERT: ${value}`);
        }

        // Update blockchain info panel
        const info = await fetch("http://127.0.0.1:3000/block-info").then(r => r.json());
        document.getElementById("latestBlock").textContent = "#" + info.blockNumber;
        document.getElementById("gasLimit").textContent = info.gasPrice;

        // Update total readings count
        const count = await fetch("http://127.0.0.1:3000/count").then(r => r.json());
        addTxLogEntry(`Total on-chain readings: ${count.total}`);

    } catch (err) {
        console.error("Backend offline, using simulation only.");
        document.getElementById("blockchainStatus").textContent = "Offline";

        document.getElementById("blockchainStatus").textContent = "Offline";
        document.getElementById("blockchainStatus").style.color = "red";

    }
}


function addTxLogEntry(text) {
    const logContainer = document.getElementById('transactionLog');
    const div = document.createElement('div');
    div.textContent = `${new Date().toLocaleString()} - ${text}`;
    logContainer.prepend(div);

    if (logContainer.children.length > 10) {
        logContainer.removeChild(logContainer.lastChild);
    }
}


        // Log transaction to blockchain
        function logToBlockchain(type, data) {
            blockNumber++;
            const timestamp = new Date().toLocaleString();
            const logEntry = `${timestamp} - Block #${blockNumber}: ${type} - ${JSON.stringify(data)}`;
            
            const logContainer = document.getElementById('transactionLog');
            const newEntry = document.createElement('div');
            newEntry.textContent = logEntry;
            logContainer.insertBefore(newEntry, logContainer.firstChild);
            
            // Keep only last 10 entries
            while (logContainer.children.length > 10) {
                logContainer.removeChild(logContainer.lastChild);
            }
            
            document.getElementById('latestBlock').textContent = '#' + blockNumber;
        }

        // Control functions
        function triggerEmergencyProtocol() {
            emergencyActive = true;
            triggerAlert("Emergency protocol activated - All systems shutting down");
            logToBlockchain('emergency_protocol', {action: 'activated', timestamp: new Date().toISOString()});
            
            setTimeout(() => {
                simulationMode = 'normal';
                emergencyActive = false;
            }, 10000);
        }

        function activateVentilation() {
            triggerAlert("Ventilation system activated", 'info');
            logToBlockchain('ventilation_control', {action: 'activated', timestamp: new Date().toISOString()});
        }

        function testAlertSystem() {
            triggerAlert("Alert system test - All systems operational", 'warning');
        }

        function calibrateSensors() {
            triggerAlert("Sensor calibration initiated", 'info');
            logToBlockchain('sensor_calibration', {action: 'initiated', timestamp: new Date().toISOString()});
        }

        function generateReport() {
            triggerAlert("Generating compliance report...", 'info');
            setTimeout(() => {
                triggerAlert("Report generated successfully", 'success');
            }, 2000);
        }

        function exportData() {
            const data = {
                sensorData: sensorData,
                timestamp: new Date().toISOString(),
                blockNumber: blockNumber
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gasguard_data_export.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function simulateGasLeak() {
            simulationMode = 'leak';
            triggerAlert("Gas leak simulation activated", 'warning');
        }

        function simulateNormalOperation() {
            simulationMode = 'normal';
            emergencyActive = false;
            hideAlert();
        }

        function resetSystem() {
            simulationMode = 'normal';
            emergencyActive = false;
            hideAlert();
            
            // Reset chart data
            sensorData = {
                methane: [],
                lpg: [],
                co: [],
                h2s: [],
                timestamps: []
            };
            
            gasChart.data.labels = [];
            gasChart.data.datasets.forEach(dataset => dataset.data = []);
            gasChart.update();
            
            logToBlockchain('system_reset', {action: 'completed', timestamp: new Date().toISOString()});
        }

        function triggerAlert(message, type = 'emergency') {
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertPanel').classList.add('show');
            
            // Auto-hide info messages
            if (type === 'info' || type === 'success') {
                setTimeout(hideAlert, 3000);
            }
        }

        function acknowledgeAlert() {
            hideAlert();
            logToBlockchain('alert_acknowledged', {timestamp: new Date().toISOString()});
        }

        function hideAlert() {
            document.getElementById('alertPanel').classList.remove('show');
        }

        // Add some dynamic behavior
        setInterval(() => {
            const activeSensors = 24 + Math.floor(Math.random() * 3) - 1;
            document.getElementById('activeSensors').textContent = activeSensors;
        }, 30000);

        // --- BACKEND POLLING STARTER (auto-runs always) ---
document.addEventListener('DOMContentLoaded', function () {
    try {
        if (typeof startBackendPolling === "function") {
            startBackendPolling();
        } else {
            console.warn("startBackendPolling not loaded yet");
        }

    } catch (err) {
        console.error("Backend poll error:", err);
    }
});

async function updateBlockchainPanel() {
    try {
        const res = await fetch("http://127.0.0.1:3000/latest-reading");
        const data = await res.json();

        // Update connection status
        document.getElementById("bc-status").innerText = "Connected";

        if (!data || data.error) {
            document.getElementById("latestReadingValue").innerText = "--";
            document.getElementById("latestReadingStatus").innerText = "--";
            document.getElementById("latestReadingTime").innerText = "--";
            document.getElementById("bc-block").innerText = "--";
            document.getElementById("bc-tx").innerText = "--";
            return;
        }

        // Fill dashboard values
        document.getElementById("latestReadingValue").innerText = data.value;
        document.getElementById("latestReadingStatus").innerText = data.status;
        document.getElementById("latestReadingTime").innerText =
            new Date(data.timestamp * 1000).toLocaleString();

        // Extra blockchain info
        document.getElementById("bc-block").innerText = data.blockNumber ?? "--";
        document.getElementById("bc-tx").innerText = data.txHash ?? "--";

    } catch (err) {
        console.error("Blockchain update error:", err);
        document.getElementById("bc-status").innerText = "Disconnected";
    }
}


async function updateMlPredictionFromValue(value, status) {
    try {
        const payload = {
            sensorData: [
                {
                    gases: {
                        methane: value,
                        lpg: value * 0.7,
                        carbonMonoxide: value * 0.45,
                        hydrogenSulfide: value * 0.25
                    },
                    environmental: {
                        temperature: 25.3,
                        humidity: 63.4,
                        pressure: 1012.5
                    }
                }
            ]
        };

        const res = await fetch("http://127.0.0.1:5000/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        // update ML panel
        document.getElementById("ml-leak-prob").innerText =
            data.leakProbability.toFixed(2) + "%";
        document.getElementById("ml-risk-level").innerText = data.riskLevel;
        document.getElementById("ml-confidence").innerText = data.confidence + "%";
        document.getElementById("ml-time-to-threshold").innerText = data.timeToThreshold;

    } catch (err) {
        console.error("ML Prediction Error:", err);
    }
}


  const params = new URLSearchParams(window.location.search);
  if (params.get("focus") === "NodeJS") {
    const el = document.getElementById("backendStatus");
    if (el) {
      el.style.boxShadow = "0 0 18px rgba(168,85,247,0.9)";
      el.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }

// Connect to the backend socket
const socket = io("http://localhost:3001");

socket.on("sensor-reading", (reading) => {
  console.log("Real-time data received:", reading);

  // Build gas-value map safely
  const gasMap = {};
  reading.gasTypes.forEach((gas, index) => {
    gasMap[gas] = reading.values[index];
  });

  // Update dashboard values (correct mapping)
  document.getElementById("methane-value").innerText = gasMap["CH4"]?.toFixed(1) ?? "--";
  document.getElementById("lpg-value").innerText     = gasMap["LPG"]?.toFixed(1) ?? "--";
  document.getElementById("co-value").innerText      = gasMap["CO"]?.toFixed(1) ?? "--";
  document.getElementById("h2s-value").innerText     = gasMap["H2S"]?.toFixed(1) ?? "--";

  // Update charts with ordered values (if chart expects fixed order)
function updateChart(values) {
  const timeStr = new Date().toLocaleTimeString();

  sensorData.timestamps.push(timeStr);
  sensorData.lpg.push(values[0]);
  sensorData.methane.push(values[1]);
  sensorData.co.push(values[2]);
  sensorData.h2s.push(values[3]);

  if (sensorData.timestamps.length > 20) {
    sensorData.timestamps.shift();
    sensorData.lpg.shift();
    sensorData.methane.shift();
    sensorData.co.shift();
    sensorData.h2s.shift();
  }

  gasChart.data.labels = sensorData.timestamps;
  gasChart.data.datasets[0].data = sensorData.methane;
  gasChart.data.datasets[1].data = sensorData.lpg;
  gasChart.data.datasets[2].data = sensorData.co;
  gasChart.data.datasets[3].data = sensorData.h2s;

  gasChart.update("none");
}

});

// Alerts
socket.on("alert", (alertData) => {
  document.getElementById("alertPanel").style.display = "block";
  document.getElementById("alertMessage").innerText = alertData.message;
});

// Blockchain panel refresh
setInterval(updateBlockchainPanel, 4000);

    </script>
</body>
</html>