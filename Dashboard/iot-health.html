<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GasGuard â€“ IoT Hardware Health & Diagnostics</title>
    <style>
        :root {
            --gg-bg: #050f24;
            --gg-surface: #0b1731;
            --gg-surface-soft: #101c3b;
            --gg-border-soft: #1f2b4d;
            --gg-text-main: #f5f7ff;
            --gg-text-sub: #a6b0d8;
            --gg-accent: #4ade80;
            --gg-accent-soft: rgba(74,222,128,0.12);
            --gg-danger: #fb7185;
            --gg-warning: #fbbf24;
            --gg-info: #38bdf8;
            --gg-card-radius: 16px;
            --gg-gap: 18px;
            --gg-shadow: 0 18px 40px rgba(0,0,0,0.45);
            --gg-font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 24px 0 40px;
            background: radial-gradient(circle at top, #0e2346 0, #050b19 60%, #020617 100%);
            font-family: var(--gg-font); color: var(--gg-text-main);
        }
        .gg-shell { max-width: 1320px; margin: 0 auto; padding: 0 24px; }

        /* HEADER */
        .gg-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; }
        .gg-title-block h1 { margin: 0; font-size: 24px; letter-spacing: 0.04em; font-weight: 700; }
        .gg-title-block h1 span { color: var(--gg-accent); }
        .gg-title-block p { margin: 4px 0 0; font-size: 12px; color: var(--gg-text-sub); max-width: 520px; }
        .gg-header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .gg-chip {
            font-size: 11px; padding: 6px 11px; border-radius: 999px;
            border: 1px solid var(--gg-border-soft); background: rgba(15,23,42,0.8);
            color: var(--gg-text-sub); display: inline-flex; align-items: center; gap: 6px;
            text-decoration: none; cursor: pointer; transition: 0.18s ease-in-out; backdrop-filter: blur(6px);
        }
        .gg-chip:hover { background: rgba(30,64,175,0.65); color: var(--gg-text-main); }
        .gg-chip.active { border-color: var(--gg-info); color: var(--gg-info); background: rgba(56,189,248,0.15); box-shadow: 0 0 16px rgba(56,189,248,0.35); }

        /* STATUS STRIP */
        .gg-status-strip { display: grid; grid-template-columns: repeat(5, minmax(0, 1fr)); gap: 10px; margin-bottom: 18px; font-size: 11px; }
        .gg-status-pill {
            background: rgba(15,23,42,0.9); border-radius: 999px; padding: 6px 12px;
            border: 1px solid rgba(148,163,184,0.25); display: flex; justify-content: space-between; align-items: center; color: var(--gg-text-sub);
        }
        .gg-status-pill strong { font-size: 11px; color: var(--gg-text-main); }
        .gg-pill-dot { width: 8px; height: 8px; border-radius: 50%; }
        .gg-pill-dot.ok { background: var(--gg-accent); box-shadow: 0 0 0 3px var(--gg-accent-soft); }
        .gg-pill-dot.warn { background: var(--gg-warning); box-shadow: 0 0 0 3px rgba(251,191,36,0.25); }
        .gg-pill-dot.crit { background: var(--gg-danger); box-shadow: 0 0 0 3px rgba(248,113,113,0.25); }

        /* PANELS */
        .gg-main-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }    
        .gg-panel {
            background: linear-gradient(135deg, #0b1731 0, #050b19 100%);
            border-radius: var(--gg-card-radius); padding: 16px 18px 18px;
            box-shadow: var(--gg-shadow); border: 1px solid rgba(148,163,184,0.25);
        }
        .gg-panel-title-row { display: flex; align-items: baseline; justify-content: space-between; margin-bottom: 10px; gap: 10px; }
        .gg-panel-title-row h2 { margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 0.12em; color: #e5e7ff; }
        .gg-panel-caption { font-size: 11px; color: var(--gg-text-sub); }

        /* HARDWARE CARDS */
        .gg-hardware-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: var(--gg-gap); margin-top: 6px; }
        .hw-card {
            position: relative; padding: 12px 14px; border-radius: 12px;
            background: radial-gradient(circle at top left, rgba(148,163,184,0.16), #020617);
            border: 1px solid rgba(148,163,184,0.35); overflow: hidden;
        }
        .hw-card::before { content: ""; position: absolute; inset: 0; border-left: 4px solid var(--gg-accent); opacity: 0.9; }
        .hw-card.mq2::before { border-left-color: #fb923c; }
        .hw-card.mq4::before { border-left-color: #38bdf8; }
        .hw-card.mq7::before { border-left-color: #f97373; }
        .hw-card.mq136::before { border-left-color: #a855f7; }
        .hw-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
        .hw-status-row { display: flex; align-items: center; gap: 6px; font-size: 11px; }
        .hw-dot { width: 9px; height: 9px; border-radius: 999px; }
        .hw-dot.ok { background: var(--gg-accent); }
        .hw-dot.crit { background: var(--gg-danger); }
        .hw-meta { font-size: 11px; color: var(--gg-text-sub); margin-top: 6px; display: flex; flex-direction: column; gap: 2px; }

        /* MAP */
        .gg-spatial-panel { margin-top: 22px; background: linear-gradient(135deg, #0b1731, #020617); border-radius: 16px; padding: 14px 16px; border: 1px solid rgba(148,163,184,0.25); box-shadow: var(--gg-shadow); }
        .gg-map-wrapper { margin-top: 10px; background: radial-gradient(circle at center, #0e2346, #020617); border-radius: 12px; padding: 10px; display: flex; align-items: center; justify-content: center; }
        .gg-map { width: 100%; max-height: 400px; }
        
        .zone { fill: rgba(255,255,255,0.02); stroke-width: 1.5; cursor: pointer; transition: 0.3s; }
        .zone:hover { fill: rgba(255,255,255,0.08); }
        .zone-label { font-size: 12px; font-weight: 800; fill: var(--gg-text-main); text-transform: uppercase; letter-spacing: 0.1em; pointer-events: none; }
        .zone-sublabel { font-size: 9px; fill: var(--gg-text-sub); text-transform: uppercase; pointer-events: none; }
        
        .gas { filter: blur(18px); opacity: 0.45; transition: 1s ease; }
        .gas-normal { fill: #22c55e; }
        .gas-warning { fill: #fbbf24; }
        .gas-danger { fill: #ef4444; }

        .sensor { r: 5; }
        .sensor.online { fill: #22c55e; }
        .sensor.warning { fill: #fbbf24; }

        .vent circle { fill: none; stroke-width: 2; }
        .vent.active { animation: spin 2s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 0.7; } 100% { opacity: 0.4; } }

        /* VIEW CONTROLS */
        .view-controls { display: flex; gap: 8px; }
        .view-btn { padding: 4px 12px; background: var(--gg-surface-soft); border: 1px solid var(--gg-border-soft); color: var(--gg-text-sub); border-radius: 4px; font-size: 10px; cursor: pointer; transition: 0.2s; }
        .view-btn.active { border-color: var(--gg-accent); color: var(--gg-accent); background: var(--gg-accent-soft); }

        /* LEGEND */
        .map-legend { display: flex; justify-content: center; gap: 24px; margin-top: 15px; padding: 12px; border-top: 1px solid var(--gg-border-soft); flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--gg-text-sub); }
        .legend-symbol { width: 12px; height: 12px; border-radius: 2px; }

        /* BUTTONS & UTILS */
        .gg-btn { border-radius: 999px; padding: 7px 12px; border: 1px solid var(--gg-border-soft); font-size: 11px; font-weight: 600; cursor: pointer; background: var(--gg-surface-soft); color: var(--gg-text-main); }
        .gg-mini-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px 14px; font-size: 11px; }
        .mini-label { font-size: 10px; text-transform: uppercase; color: var(--gg-text-sub); }
        .mini-value { font-size: 13px; font-weight: 600; }
        
        .diag-panel { background: var(--gg-surface-soft); border-radius: var(--gg-card-radius); padding: 14px 16px 16px; border: 1px solid var(--gg-border-soft); margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px;}
        th { text-align: left; color: var(--gg-text-sub); padding: 8px; border-bottom: 1px solid var(--gg-border-soft); }
        td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .diag-type { font-size: 10px; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
        .diag-type.info { background: rgba(56,189,248,0.2); color: var(--gg-info); }
        .diag-type.warn {
    background: rgba(251,191,36,0.25);
    color: var(--gg-warning);
}

.diag-type.error {
    background: rgba(248,113,113,0.25);
    color: var(--gg-danger);
}

.diag-panel table tbody tr:hover {
    background: rgba(255,255,255,0.04);
}
    </style>
</head>

<body data-context="iot">
    <div class="gg-shell">
        <!-- HEADER -->
        <div class="gg-header">
            <div class="gg-title-block">
                <h1>GasGuard â€“ <span>IoT Hardware Health</span></h1>
                <p>Monitor sensor connectivity, ESP32 status, and automatic ventilation hardware.</p>
            </div>
            <div class="gg-header-actions">
                <a href="main.html" class="gg-chip">Live Dashboard</a>
                <a href="iot-health.html" class="gg-chip active">IoT Health</a>
                <a href="blockchain-history.html" class="gg-chip">Blockchain</a>
                <a href="system-connections.html" class="gg-chip">Connections</a>
            </div>
        </div>

        <!-- STATUS STRIP -->
        <div class="gg-status-strip">
            <div class="gg-status-pill"><strong>System</strong><div class="gg-pill-value"><span class="gg-pill-dot ok"></span> Online</div></div>
            <div class="gg-status-pill"><strong>ESP32</strong><div class="gg-pill-value"><span id="pill-dot-esp32" class="gg-pill-dot crit"></span> <span id="pill-text-esp32">Offline</span></div></div>
            <div class="gg-status-pill"><strong>MQTT</strong><div class="gg-pill-value"><span class="gg-pill-dot ok"></span> Connected</div></div>
            <div class="gg-status-pill"><strong>Sensors</strong><div class="gg-pill-value"><span id="pill-text-sensors">0 / 4</span></div></div>
            <div class="gg-status-pill"><strong>Vent</strong><div class="gg-pill-value"><span class="gg-pill-dot ok"></span> Active</div></div>
        </div>

        <div class="gg-main-grid">
            <div class="gg-panel">
                <div class="gg-panel-title-row">
                    <h2>Sensor & Device Health</h2>
                    <span class="gg-panel-caption">Real-time signal stability and heartbeat.</span>
                </div>
                <div class="gg-hardware-grid">
                    <div class="hw-card mq2"><div class="hw-name">MQ-2 LPG</div><div class="hw-status-row"><div class="hw-dot ok"></div> Online</div><div class="hw-meta"><span>Stability: 98%</span><span>ID: MQ2-01</span></div></div>
                    <div class="hw-card mq4"><div class="hw-name">MQ-4 Methane</div><div class="hw-status-row"><div class="hw-dot ok"></div> Online</div><div class="hw-meta"><span>Stability: 99%</span><span>ID: MQ4-01</span></div></div>
                    <div class="hw-card mq7"><div class="hw-name">MQ-7 CO</div><div class="hw-status-row"><div class="hw-dot ok"></div> Online</div><div class="hw-meta"><span>Stability: 94%</span><span>ID: MQ7-01</span></div></div>
                    <div class="hw-card mq136"><div class="hw-name">MQ-136 Hâ‚‚S</div><div class="hw-status-row"><div class="hw-dot ok"></div> Online</div><div class="hw-meta"><span>Stability: 96%</span><span>ID: MQ136-01</span></div></div>
                </div>
            </div>
        </div>

        <!-- ================= SPATIAL INTELLIGENCE MAP ================= -->
        <div class="gg-spatial-panel">
            <div class="gg-panel-title-row">
                <div>
                    <h2>Spatial Gas Intelligence Map</h2>
                    <span class="gg-panel-caption">Real-time sensor fusion & ventilation visualization</span>
                </div>
                <div class="view-controls">
                    <button class="view-btn active" id="btn-factory" onclick="toggleMap('factory')">Full Factory View</button>
                    <button class="view-btn" id="btn-zones" onclick="toggleMap('zones')">Zonal Analysis</button>
                </div>
            </div>

            <div class="gg-map-wrapper">
                <svg viewBox="0 0 800 500" class="gg-map" id="factory-svg">
                    <!-- ================= UNIFIED FACTORY LAYOUT ================= -->
                    <g id="map-unified">
                        <path d="M 50,50 L 750,50 L 750,450 L 50,450 Z" fill="rgba(15, 23, 42, 0.5)" stroke="var(--gg-border-soft)" stroke-width="2" />
                        <path d="M 400,50 L 400,200 M 400,300 L 400,450 M 50,250 L 750,250" stroke="rgba(31, 43, 77, 0.8)" stroke-width="2" stroke-dasharray="8,4" />
                        <path d="M 100,100 L 700,100 L 700,400 L 100,400 Z" fill="none" stroke="rgba(56, 189, 248, 0.2)" stroke-width="6" />
                        
                        <g class="zone-pointer" data-zone="A" style="cursor:pointer" onclick="goToZone('A')">
                            <text x="70" y="80" class="zone-label">Zone A: Storage</text>
                            <circle cx="160" cy="150" r="80" class="gas gas-normal" />
                            <circle cx="140" cy="140" r="5" class="sensor online" />
                        </g>
                        <g class="zone-pointer" data-zone="B" style="cursor:pointer" onclick="goToZone('B')">
                            <text x="420" y="80" class="zone-label">Zone B: Compression</text>
                            <circle cx="580" cy="150" r="60" class="gas gas-warning" />
                            <circle cx="600" cy="140" r="5" class="sensor warning" />
                        </g>
                        <g class="zone-pointer" data-zone="C" style="cursor:pointer" onclick="goToZone('C')">
                            <text x="70" y="280" class="zone-label">Zone C: Refinery</text>
                            <circle cx="200" cy="350" r="100" class="gas gas-danger" />
                            <circle cx="180" cy="340" r="5" class="sensor online" />
                        </g>
                        <g class="zone-pointer" data-zone="D" style="cursor:pointer" onclick="goToZone('D')">
    <text x="420" y="280" class="zone-label">Zone D: Utility Area</text>
    <circle cx="580" cy="350" r="70" class="gas gas-normal" />
    <circle cx="600" cy="340" r="5" class="sensor online" />
</g>

                    </g>

                    <!-- ================= ZONAL ANALYSIS VIEW ================= -->
                    <g id="map-zonal" style="display:none">
                        <g class="zone-group" data-zone="A" transform="translate(40 60)" onclick="goToZone('A')">
                            <rect width="340" height="180" rx="12" class="zone zone-a" stroke="#38bdf8"/>
                            <text x="15" y="25" class="zone-label">Zone A</text>
                            <text x="15" y="40" class="zone-sublabel">Primary Intake</text>
                            <circle cx="170" cy="110" r="70" class="gas gas-normal" />
                        </g>

                        <g class="zone-group" data-zone="B" transform="translate(420 60)" onclick="goToZone('B')">
    <rect width="340" height="180" rx="12" class="zone zone-b" stroke="#fbbf24"/>
    <text x="15" y="25" class="zone-label">Zone B</text>
    <text x="15" y="40" class="zone-sublabel">Compression Unit</text>
    <circle cx="170" cy="110" r="65" class="gas gas-warning" />
</g>

                 <g class="zone-group" data-zone="C" transform="translate(40 260)" onclick="goToZone('C')">
                            <rect width="340" height="180" rx="12" class="zone zone-c" stroke="#f97373"/>
                            <text x="15" y="25" class="zone-label">Zone C</text>
                            <text x="15" y="40" class="zone-sublabel">Refinery Link</text>
                            <circle cx="170" cy="110" r="80" class="gas gas-danger" />
                        </g>

                        <g class="zone-group" data-zone="D" transform="translate(420 260)" onclick="goToZone('D')">
    <rect width="340" height="180" rx="12" class="zone zone-d" stroke="#22c55e"/>
    <text x="15" y="25" class="zone-label">Zone D</text>
    <text x="15" y="40" class="zone-sublabel">Utility Area</text>
    <circle cx="170" cy="110" r="60" class="gas gas-normal" />
</g>
                    </g>
                </svg>
            </div>

            <!-- Detailed Legend -->
            <div class="map-legend">
                <div class="legend-item"><div class="legend-symbol" style="background: var(--gg-accent); border-radius: 50%;"></div><span><b>Sensor:</b> Active</span></div>
                <div class="legend-item"><div class="legend-symbol" style="background: var(--gg-warning); border-radius: 50%;"></div><span><b>Sensor:</b> Check</span></div>
                <div class="legend-item"><div class="legend-symbol" style="border: 2px solid #60a5fa; background: transparent;"></div><span><b>Vent:</b> Active</span></div>
                <div class="legend-item"><div class="legend-symbol" style="background: #ef4444; filter: blur(4px); opacity: 0.6;"></div><span><b>Gas:</b> Alert</span></div>
            </div>
        </div>

        <div class="diag-panel">
            <h3>IoT Diagnostics Log</h3>
            <table><thead>
<tr>
    <th style="width:120px">Time</th>
    <th style="width:120px">Device</th>
    <th style="width:80px">Level</th>
    <th>Message</th>
</tr>
</thead>

                <tbody id="diag-body">
                    <tr><td>23:14:02</td><td>ESP32-01</td><td><span class="diag-type info">INFO</span></td><td>Heartbeat received via MQTT</td></tr>
                    <tr><td>23:13:45</td><td>MQ-4</td><td><span class="diag-type info">INFO</span></td><td>Baseline calibration stable</td></tr>
                </tbody>
            </table>
        </div>

        <div class="footer" style="text-align:center; margin-top:30px; opacity:0.6; font-size:11px;">
            ðŸ”§ IoT Layer â€“ Hardware observability for GasGuard
        </div>
    </div>

    <script>
        const IOT_BASE = "http://127.0.0.1:3000/iot";

        function toggleMap(mode) {
            const unified = document.getElementById('map-unified');
            const zonal = document.getElementById('map-zonal');
            const btnFact = document.getElementById('btn-factory');
            const btnZone = document.getElementById('btn-zones');

            if (mode === 'factory') {
                unified.style.display = 'block';
                zonal.style.display = 'none';
                btnFact.classList.add('active');
                btnZone.classList.remove('active');
            } else {
                unified.style.display = 'none';
                zonal.style.display = 'block';
                btnFact.classList.remove('active');
                btnZone.classList.add('active');
            }
        }

        function goToZone(id) {
            const ppmMap = { A: 180, B: 260, C: 520, D: 120 };
            window.location.href = `zone-3d.html?zone=${id}&ppm=${ppmMap[id]}`;
        }

        async function fetchStatus() {
            try {
                const res = await fetch(`${IOT_BASE}/system-status`);
                const data = await res.json();
                document.getElementById("pill-text-sensors").innerText = `${data.sensorsOnline || 4} / 4`;
            } catch (e) { console.warn("Backend offline"); }
        }

        setInterval(fetchStatus, 5000);
    </script>
</body>
</html>
