<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GasGuard – System Connections</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* ===================== THEME (MATCH main.html) ===================== */
:root {
  --gg-bg: #050f24;
  --gg-surface: #0b1731;
  --gg-border-soft: #1f2b4d;
  --gg-text-main: #f5f7ff;
  --gg-text-sub: #a6b0d8;
  --gg-accent: #4ade80;
  --gg-accent-soft: rgba(74,222,128,0.12);
  --gg-warning: #fbbf24;
  --gg-info: #38bdf8;
  --gg-danger: #fb7185;
  --gg-radius: 18px;
  --gg-shadow: 0 18px 40px rgba(0,0,0,0.45);
  --gg-font: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

* { box-sizing: border-box; }

html, body {
  height: 100%;
}

body {
  margin: 0;
  font-family: var(--gg-font);
  color: var(--gg-text-main);
  background:
    radial-gradient(circle at top, #0e2346 0, #050b19 60%, #020617 100%);
}

/* ===================== PAGE SHELL ===================== */
.gg-shell {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
  min-height: 100vh; /* FILL SCREEN */
  display: flex;
  flex-direction: column;
}

/* ===================== HEADER ===================== */
.gg-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 18px;
}

.gg-title h1 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 0.04em;
}
.gg-title h1 span { color: var(--gg-accent); }

.gg-title p {
  margin: 4px 0 0;
  font-size: 12px;
  color: var(--gg-text-sub);
}

.gg-nav {
  display: flex;
  gap: 10px;
}

.gg-chip {
  padding: 6px 14px;
  border-radius: 999px;
  border: 1px solid var(--gg-border-soft);
  background: rgba(15,23,42,0.85);
  color: var(--gg-text-sub);
  font-size: 11px;
  text-decoration: none;
}
.gg-chip.active {
  border-color: var(--gg-accent);
  color: var(--gg-accent);
  background: var(--gg-accent-soft);
}

/* ===================== MAIN GRID ===================== */
.gg-main {
  flex: 1; /* TAKE REMAINING HEIGHT */
  display: grid;
    grid-template-columns: minmax(0, 1fr) 360px;
  gap: 18px;
    gap: 20px;
    width: 100%;
    max-width: 100%;
    overflow: visible;
}

/* ===================== GLASS PANELS ===================== */
.gg-panel {
  background: linear-gradient(135deg, rgba(11,23,49,0.9), rgba(5,11,25,0.9));
  border-radius: var(--gg-radius);
  padding: 16px 18px;
  border: 1px solid rgba(148,163,184,0.25);
  box-shadow: var(--gg-shadow);
  display: flex;
  flex-direction: column;
}

.gg-panel h2 {
  margin: 0 0 10px;
  font-size: 13px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
}

/* ===================== TOPOLOGY ===================== */
.gg-topology {
  flex: 1;
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: flex-start;  
  padding-top: 12px;        
  min-height: calc(100vh - 180px); 
    display: flex;
    flex-direction: column;
     max-width: 100%;
    overflow: hidden;
       align-items: center;
    justify-content: center;
}


.gg-topology svg {
  width: 100%;
  height: auto;
  min-height: 420px;
  max-width: none;   
  display: block;
}



/* Nodes */
.node {
  fill: #020617;
  stroke-width: 1.6;
}
.sensor { stroke: var(--gg-info); }
.gateway { stroke: var(--gg-accent); }
.backend { stroke: #a855f7; }
.cloud { stroke: var(--gg-warning); }

/* Links */
.link {
  fill: none;
  stroke-width: 2;
  stroke-dasharray: 6 4;
  animation: flow 2.5s linear infinite;
}
.ok { stroke: var(--gg-accent); }
.warn { stroke: var(--gg-warning); }

@keyframes flow {
  from { stroke-dashoffset: 0; }
  to { stroke-dashoffset: -24; }
}

.label {
  font-size: 11px;
  fill: #e5e7eb;
  text-anchor: middle;
}

/* ===================== STATUS CARDS ===================== */
.gg-status {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.gg-status-card {
  background: rgba(15,23,42,0.9);
  border-radius: 14px;
  padding: 14px 16px;
  border: 1px solid rgba(148,163,184,0.25);
}

.gg-status-card h3 {
  margin: 0 0 8px;
  font-size: 12px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
}

.line {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  margin: 5px 0;
}

.dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}
.dot.ok { background: var(--gg-accent); }
.dot.warn { background: var(--gg-warning); }

/* ===================== RESPONSIVE ===================== */
@media (max-width: 1100px) {
  .gg-main { grid-template-columns: 1fr; }
}
.topology-node.highlight rect {
    stroke: #4ade80;
    stroke-width: 2.5;
    filter: drop-shadow(0 0 10px rgba(74,222,128,0.9));
}
/* === LIVE STATUS STATES === */
.node.ok {
  stroke: #4ade80;
  filter: drop-shadow(0 0 8px rgba(74,222,128,0.7));
}

.node.warn {
  stroke: #fbbf24;
  filter: drop-shadow(0 0 8px rgba(251,191,36,0.6));
}

.node.crit {
  stroke: #fb7185;
  filter: drop-shadow(0 0 8px rgba(251,113,133,0.7));
}
@keyframes dashFlow {
  to {
    stroke-dashoffset: -20;
  }
}

.flow {
  stroke-dasharray: 6 6;
  animation: dashFlow 1.2s linear infinite;
}


</style>
</head>

<body>
<div class="gg-shell">

<!-- HEADER -->
<div class="gg-header">
  <div class="gg-title">
    <h1>GasGuard – <span>System Connections</span></h1>
    <p>End-to-end topology of IoT, Edge, Cloud, Blockchain and ML services.</p>
  </div>
  <div class="gg-nav">
    <a class="gg-chip" href="main.html">Live Dashboard</a>
    <a class="gg-chip" href="iot-health.html">IoT Health</a>
    <a class="gg-chip" href="blockchain-history.html">Blockchain</a>
    <a class="gg-chip active">Connections</a>
  </div>
</div>

<!-- MAIN -->
<div class="gg-main">

<!-- TOPOLOGY -->
<div class="gg-panel">
  <h2>System Topology</h2>

  <div class="gg-topology">
<svg viewBox="0 0 1200 420" preserveAspectRatio="xMidYMid meet" class="topology-map">

      <!-- Sensors -->
      <rect x="40" y="40" width="200" height="36" rx="10" class="node sensor"/>
      <text x="140" y="63" class="label">MQ-4 Methane (Zone A)</text>

      <rect x="40" y="95" width="200" height="36" rx="10" class="node sensor"/>
      <text x="140" y="118" class="label">MQ-2 LPG (Zone B)</text>

      <rect x="40" y="150" width="200" height="36" rx="10" class="node sensor"/>
      <text x="140" y="173" class="label">MQ-7 CO (Zone C)</text>

      <rect x="40" y="205" width="200" height="36" rx="10" class="node sensor"/>
      <text x="140" y="228" class="label">MQ-136 H₂S (Zone D)</text>

      <!-- ESP32 -->
   <g class="topology-node" data-node="ESP32">
  <rect x="340" y="145" width="240" height="44" rx="12" class="node gateway"/>
  <text x="460" y="173" class="label">ESP32 Edge Gateway</text>
</g>

<!-- Backend -->
<g class="topology-node" data-node="NodeJS">
  <rect x="650" y="145" width="260" height="44" rx="12" class="node backend"/>
  <text x="780" y="173" class="label">Node.js Backend</text>
</g>

<!-- Cloud / Analytics -->

<g class="topology-node" data-node="MongoDB">
  <rect x="950" y="40" width="220" height="36" rx="10" class="node cloud"/>
  <text x="1060" y="63" class="label">MongoDB Atlas</text>
</g>

<g class="topology-node" data-node="Blockchain">
  <rect x="950" y="95" width="220" height="36" rx="10" class="node cloud"/>
  <text x="1060" y="118" class="label">Blockchain Ledger</text>
</g>

<g class="topology-node" data-node="ML">
  <rect x="950" y="150" width="220" height="36" rx="10" class="node cloud"/>
  <text x="1060" y="173" class="label">ML Prediction Engine</text>
</g>

<g class="topology-node" data-node="DigitalTwin">
  <rect x="950" y="205" width="220" height="36" rx="10" class="node cloud"/>
  <text x="1060" y="228" class="label">Digital Twin</text>
</g>

<!-- Links -->
<line x1="240" y1="58"  x2="340" y2="167" class="link flow ok"/>
<line x1="240" y1="113" x2="340" y2="167" class="link flow ok"/>
<line x1="240" y1="168" x2="340" y2="167" class="link flow warn"/>
<line x1="240" y1="223" x2="340" y2="167" class="link flow ok"/>

<line x1="580" y1="167" x2="650" y2="167" class="link flow ok"/>

<line x1="910" y1="167" x2="950" y2="58"  class="link flow ok"/>
<line x1="910" y1="167" x2="950" y2="113" class="link flow ok"/>
<line x1="910" y1="167" x2="950" y2="168" class="link flow warn"/>
<line x1="910" y1="167" x2="950" y2="223" class="link flow ok"/>


    </svg>
  </div>
</div>

<!-- STATUS -->
<div class="gg-status">
  <div class="gg-status-card">
    <h3>Edge & IoT</h3>
    <div class="line"><span>ESP32</span><span class="dot ok"></span></div>
    <div class="line"><span>Sensors</span><span class="dot ok"></span></div>
    <div class="line"><span>MQTT</span><span class="dot warn"></span></div>
  </div>

  <div class="gg-status-card">
    <h3>Cloud & Analytics</h3>
    <div class="line"><span>MongoDB</span><span class="dot ok"></span></div>
    <div class="line"><span>Blockchain</span><span class="dot ok"></span></div>
    <div class="line"><span>ML Engine</span><span class="dot ok"></span></div>
  </div>
</div>

</div>
</div>
<cscript>
<script>
  const nodeRoutes = {
    "ESP32": "iot-health.html",
    "Sensors": "iot-health.html",
    "MQTT": "iot-health.html",

    "NodeJS": "main.html",

    "MongoDB": "blockchain-history.html",
    "Blockchain": "blockchain-history.html",
    "ML": "blockchain-history.html"
  };

  document.querySelectorAll(".topology-node").forEach(node => {
    node.style.cursor = "pointer";

    node.addEventListener("click", () => {
      const key = node.dataset.node;
      if (!key || !nodeRoutes[key]) return;

      window.location.href = `${nodeRoutes[key]}?focus=${key}`;
    });
  });

    const API_BASE = "http://localhost:3001/api";

  const params = new URLSearchParams(window.location.search);
const focus = params.get("focus");

if (focus) {
    const el = document.querySelector(`[data-node="${focus}"]`);
    if (el) {
        el.classList.add("highlight");
    }
}

</script>
<script>
const STATUS_API = "http://127.0.0.1:3000/system-status";

async function updateTopologyStatus() {
  try {
    const res = await fetch(STATUS_API);
    const data = await res.json();

    setNode("ESP32", data.esp32Status);
    setNode("Sensors", data.sensorsOnline === 4 ? "online" : "degraded");
    setNode("MQTT", data.mqttStatus);

    setNode("MongoDB", data.mongodb);
    setNode("Blockchain", data.blockchain);
    setNode("ML", data.mlEngine);

  } catch (e) {
    setNode("ESP32", "offline");
    setNode("NodeJS", "offline");
  }
}

function setNode(key, status) {
  const el = document.querySelector(`[data-node="${key}"] .node`);
  if (!el) return;

  el.classList.remove("ok","warn","crit");

  const s = (status || "").toLowerCase();
  if (s === "online" || s === "connected") el.classList.add("ok");
  else if (s === "degraded" || s === "unstable") el.classList.add("warn");
  else el.classList.add("crit");
}

setInterval(updateTopologyStatus, 5000);
updateTopologyStatus();
</script>

</cscript>
</body>
</html>
